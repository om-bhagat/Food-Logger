<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register / Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- <link rel="stylesheet" href="/register/style2.css"/> -->
</head>
<body>
  <main style="max-width:680px;margin:24px auto;">
    <!-- your forms ... -->
    <button id="googleBtn" type="button" class="google-btn">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" style="vertical-align:middle;margin-right:8px;">
      Continue with Google
    </button>
  </main>

  <script>
  const GOOGLE_CLIENT_ID = "426525445987-sut43e32f0l4658k2mh2r6cjgtr28jkp.apps.googleusercontent.com";

  window.onload = () => {
    const codeClient = google.accounts.oauth2.initCodeClient({
      client_id: GOOGLE_CLIENT_ID,
      scope: "openid email profile",
      ux_mode: "popup",
      redirect_uri: "http://localhost:3000/auth/google/callback",
      callback: async (resp) => {
        if (!resp || !resp.code) { alert("Google error"); return; }
        const res = await fetch("/auth/google/exchange", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ code: resp.code })
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data.ok) { alert("Exchange failed: " + (data.error || "unknown")); return; }
        window.location.href = "/test.html";
      }
    });
    document.getElementById("googleBtn").addEventListener("click", () => codeClient.requestCode());
  };
</script>

  <script type="module" src="/register/script2.js"></script>
</body>
</html>
